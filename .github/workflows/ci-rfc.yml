name: ci-rfc
on:
  pull_request:
    paths:
      - "docs/rfcs/**"
      - ".github/workflows/ci-rfc.yml"

jobs:
  rfc_checks:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Ensure RFC index exists
        # El estándar exige README.md en la nueva ruta
        run: test -f docs/rfcs/README.md

      - name: Enforce RFC filename convention
        run: |
          set -e
          # Permite RFC-00_MANIFEST.md (Mayúsculas) y rfc-nn-nombre.md (Minúsculas)
          bad=$(find docs/rfcs -maxdepth 1 -type f -name "*.md" \
            ! -name "README.md" \
            ! -name "RFC-00_MANIFEST.md" \
            ! -regex ".*/rfc-[0-9][0-9][a-z]?-.*\.md" \
            -print)
          if [ -n "$bad" ]; then
            echo "Invalid RFC filename(s): $bad"
            exit 1
          fi

      - name: Require RFC template sections (minimum)
        run: |
          set -e
          for f in $(find docs/rfcs -maxdepth 1 -type f -name "*.md" ! -name "README.md"); do
            echo "Validating $f..."
            grep -q "^## Propósito" "$f"
            grep -q "^## No-Goals" "$f"
            grep -q "^## Invariantes" "$f"
            grep -q "^## Threat Model" "$f"
            grep -q "^## Pruebas" "$f"
            grep -q "^## Criterios de Aceptación" "$f"
          done